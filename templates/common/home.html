{% extends 'layouts/base.html' %}
{% block title %}
Home
{% endblock title %}
{% block content %}
<!-- carousel taken from  -->
<div class="container">
    
    {% if img_carousel|length > 0 %}
    <div id="carouselExampleControls" class="carousel slide mb-4" data-ride="carousel">
        <div class="carousel-inner">
            <div class="carousel-item active">
                <img class="d-block w-100" src="{{url_for('static', filename='media/'+img_carousel[carou_active_key])}}"
                    alt="Slide 0">
            </div>
            {% for key in carou_others_keys %}
            <div class="carousel-item">
                <img class="d-block w-100" src="{{url_for('static', filename='media/'+img_carousel[key])}}"
                    alt="Slide {{key}}">
            </div>
            {% endfor %}
        </div>
        <a class="carousel-control-prev" href="#carouselExampleControls" role="button" data-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="sr-only">Previous</span>
        </a>
        <a class="carousel-control-next" href="#carouselExampleControls" role="button" data-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="sr-only">Next</span>
        </a>
    </div>
    {% endif %}
</div>
<div class="toast" role="alert" aria-live="polite" aria-atomic="true" data-delay="3000"
        style="position: sticky; top: 15%; transform: translate(-50%, -50%); left:50%; z-index: 999;">
        <div class="toast-header">
            &#128276; &nbsp;
            <strong class="mr-auto">Notification</strong>
            <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="toast-body" id="alert_message" style="font-weight: bolder;">
            Hello, world! This is a toast message.
        </div>
    </div>
<div class="container justify-content-center">
    <h2 style="font-size: 2.5em;" class="mb-3">Featured</h2>
</div>

<div class="container justify-content-center align-items-center">
    <div class="row">
        {% for entry in featured_products %}
        <div class="col-6 col-lg-3 col-md-4">
            <div class="card card-product">
                <div class="img-product">
                    <a href="/catalog/product/{{product_keys[entry].uuid}}">
                        <img class="card-img img-fluid"
                            src="{{url_for('static', filename='media/'+product_keys[entry].images[0])}}" alt="">
                    </a>
                </div>
                <div class="card-body">
                    <h4 class="card-title">{{product_keys[entry].name}}</h4>
                    <h6 class="card-subtitle mb-2 text-muted">{{bc[product_keys[entry].brand].name}}</h6>
                    <div class="buy d-flex justify-content-between">
                        <div class="price text-success">
                            <h5 class="">${{"%.2f"|format(product_keys[entry].centprice/100)}}</h5>
                        </div>
                    </div>
                    <div class="justify-content-center row">
                        <input type="hidden" name="quantity" id="{{product_keys[entry].uuid}}_quantity" value="1">
                        <button class="btn btn-success btn-sm col-10" onclick="add_cart(this)"
                            id="{{product_keys[entry].uuid}}"><i class="fas fa-shopping-cart mr-2"></i>Add</button>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}

    </div>
</div>
<!-- add to cart function and alerts -->
<style>
    #query {
        font-weight: bold;
        color: darkred;
    }
</style>
<script>
    function add_cart(item) {
        var item_id = item.id;
        var item_quantity = $(`#${item_id}_quantity`).val()
        var item = {
            "id": item_id,
            "quantity": item_quantity
        };

        fetch(`${window.location.origin}/user/add_cart`,
            {
                method: "POST",
                credentials: "include",
                body: JSON.stringify(item),
                cache: "no-cache",
                headers: new Headers({
                    "content-type": "application/json"
                })
            }).then(
                response => response.json()
            ).then(function (data) {
                let cart_count = data.item_in_cart;
                let message = data.alert_message;
                document.getElementById("number_of_items").innerHTML = cart_count;
                document.getElementById("alert_message").innerHTML = message;
                $('.toast').toast('show');
                console.log(cart_count)
            }).catch(function (error) {
                console.log("Fetch error: " + error);
            });

    };
</script>
{% endblock content %}