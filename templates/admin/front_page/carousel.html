{% extends 'layouts/admin_base.html' %}
{% block title %}
Carousel
{% endblock title %}
{% block content %}
<div class="container-fluid p-4">
    <h3>
        Carousel
    </h3>
    <div class="row">
        <div class="col-lg-6">
            <ul class="nav nav-tabs" id="myTab" role="tablist">
                <li class="nav-item" role="presentation">
                    <a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab"
                        aria-controls="home" aria-selected="true">Add Images</a>
                </li>
                <li class="nav-item" role="presentation">
                    <a class="nav-link" id="profile-tab" data-toggle="tab" href="#profile" role="tab"
                        aria-controls="profile" aria-selected="false">Current Images</a>
                </li>
            </ul>
            <div class="tab-content" id="myTabContent">
                <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
                    <div class="col-12 mt-3">
                        {% from '_formhelpers.html' import render_field %}
                        <form action="" method="POST" enctype="multipart/form-data">
                            <div class="row">
                                <div class="col-12">{{ render_field(form.image_0, class="form-control")}}</div>
                                <div class="col-12">{{ render_field(form.image_1, class="form-control")}}</div>
                                <div class="col-12">{{ render_field(form.image_2, class="form-control")}}</div>
                                <div class="col-12">{{ render_field(form.image_3, class="form-control")}}</div>
                                <div class="col-12">{{ render_field(form.image_4, class="form-control")}}</div>
                            </div>
                            <input type="submit" value="Update Carousel" class="btn btn-success mt-2">
                        </form>
                    </div>
                </div>
                <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">
                    <div class="col-12 row mt-3">
                        <div class="col-12">
                            <button class="btn btn-danger disabled" onclick="submit_delete(this)" id="btn_delete"><i
                                    class="fa fa-trash"></i>
                                Selected</button>
                        </div>
                        {% for i in img_carousel %}
                        <div class="col-6">
                            <p class="mb-2 font-weight-bold">Image {{i+1}}</p>
                            <img class="img-fluid mb-2" onclick="select_slide(this)" style="cursor: pointer;"
                                src="{{url_for('static', filename='media/' + img_carousel[i])}}" alt="No Image"
                                id={{i}}>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-6">
            <div class="embed-responsive embed-responsive-1by1">
                <iframe class="embed-responsive-item" src="/" id="preview"></iframe>
            </div>
        </div>
    </div>
</div>
<script>
    var selected_slides = [];
    function select_slide(img) {
        if (selected_slides.includes(img.id)) {
            //giving feedback if the image is selected
            $(img).css("border-style", "")
            $(img).css("border-color", "")
            index = selected_slides.indexOf(img.id)
            selected_slides.splice(index, 1)
        } else {
            $(img).css("border-style", "solid")
            $(img).css("border-color", "red")
            selected_slides.push(img.id)
        }

        if (selected_slides.length > 0) {
            $("#btn_delete").removeClass("disabled")
        } else (
            $("#btn_delete").addClass("disabled")
        )
    }

    function submit_delete(btn) {
        if (!$(btn).hasClass("disabled")) {
            console.log(selected_slides)
            //parsing it into flask
            $.ajax({
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify(selected_slides),
                dataType: "json",
                url: `${window.location.origin}/admin/front-page/delete/carousel`,
                success: function (e) {
                    console.log("Deleted")
                    location.reload(true)
                },
                error: function (error) {
                    console.log(error)
                }

            })
        }
    }
</script>
{% endblock content %}